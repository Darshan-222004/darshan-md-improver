name: 'Darshan Markdown Improver'
description: 'Improves markdown files using OpenAI'

inputs:
  repo:
    required: true
    description: 'GitHub repo URL'
  mdfile:
    required: true
    description: 'Markdown file path'
  purpose:
    required: true
    description: 'Purpose of the improvement'
  token:
    required: true
    description: 'GitHub Token for making PRs'

runs:
  using: "composite"
  steps:
    - name: Checkout target repo
      uses: actions/checkout@v4
      with:
        repository: ${{ inputs.repo }}

    - name: Run improvement script
      shell: bash
      run: chmod +x ./entrypoint.sh && ./entrypoint.sh "${{ inputs.repo }}" "${{ inputs.mdfile }}" "${{ inputs.purpose }}" "${{ inputs.token }}"
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}  # Now properly passed
